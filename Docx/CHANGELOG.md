# æ›´æ–°æ—¥å¿—

## 2025-12-13 - AdaSmooth-ZO å®ç°

### âœ… æ–°å¢åŠŸèƒ½

#### AdaSmooth-ZO ä¼˜åŒ–å™¨ âœ¨ æœ€æ–°
å®ç° AdaSmooth-ZO (Adaptive Smoothing with Low-Rank Updates)ï¼Œä¸€ä¸ªåˆ›æ–°çš„é›¶é˜¶ä¼˜åŒ–ç®—æ³•ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- **ä½ç§©è‡ªé€‚åº”é‡‡æ ·ï¼š** x = Î¸ + LÂ·uï¼Œå…¶ä¸­ L âˆˆ R^(dÃ—K)
- **KL æ­£åˆ™åŒ–ï¼š** é€šè¿‡ KL æ•£åº¦çº¦æŸçš„ç­–ç•¥ä¼˜åŒ–
- **çŸ©é˜µåŒ¹é…ï¼š** å°†æœ€ä¼˜ç­–ç•¥æŠ•å½±å›é«˜æ–¯æ—
- **æ¸©åº¦è°ƒåº¦ï¼š** æ§åˆ¶æ¢ç´¢-åˆ©ç”¨æƒè¡¡
- **æ•°å€¼ç¨³å®šï¼š** Log-sum-exp æŠ€å·§é˜²æ­¢æº¢å‡º
- **å¤æ‚åº¦ï¼š** O(Kd) æ—¶é—´å’Œç©ºé—´

**ä¸¤ä¸ªç‰ˆæœ¬ï¼š**
1. **AdaSmoothZO** - å•å‚æ•°å¼ é‡ä¼˜åŒ–
2. **AdaSmoothZO_MultiParam** - å¤šå‚æ•°æ¨¡å‹ä¼˜åŒ–ï¼ˆç¥ç»ç½‘ç»œç­‰ï¼‰

**æ¸©åº¦è°ƒåº¦ç­–ç•¥ï¼š**
- Constant: Î²_t = Î²_0
- Polynomial: Î²_t = Î²_0 / (1 + decayÂ·t)ï¼ˆé»˜è®¤ï¼‰
- Exponential: Î²_t = Î²_0 Â· exp(-decayÂ·t)

**æ•°å­¦åŸºç¡€ï¼š**
```
æœç´¢åˆ†å¸ƒ: Ï€(x) = N(x; Î¸, LL^T)
ä¼˜åŒ–ç›®æ ‡: min_Ï€ E_{x~Ï€}[F(x)] + Î²Â·KL(Ï€ || Ï€_old)
å‡å€¼æ›´æ–°: Î¸_{t+1} = Î£ w_k Â· x_k
åæ–¹å·®æ›´æ–°: L_{t+1} = [âˆšw_1Â·(x_1 - Î¸), ..., âˆšw_KÂ·(x_K - Î¸)]
æƒé‡è®¡ç®—: w_k = exp(-f_k/Î²) / Z
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `optimizer/zo.py` - å®ç°ä¸¤ä¸ª AdaSmooth-ZO ç±»ï¼ˆ~400è¡Œï¼‰
- `utils.py` - æ³¨å†Œä¼˜åŒ–å™¨
- `config/synthetic.yaml` - æ·»åŠ é…ç½®å’Œå‚æ•°æ–‡æ¡£
- `config/adversarial.yaml` - æ·»åŠ é…ç½®
- `config/synthetic-baseline.yaml` - æ·»åŠ åˆ°è‡ªé€‚åº”æ–¹æ³•ç»„

**æ–‡æ¡£ï¼š**
- `Docx/AdaSmoothZO_usage.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼ˆ517è¡Œï¼‰
- `Docx/AdaSmooth-ZO_IMPLEMENTATION_COMPLETE.md` - å®ç°å®ŒæˆæŠ¥å‘Š

**æµ‹è¯•ç»“æœï¼š** âœ… å…¨éƒ¨é€šè¿‡
- å•å‚æ•°ç‰ˆæœ¬ç¨³å®šæ€§æµ‹è¯•
- å¤šå‚æ•°ç‰ˆæœ¬ç¨³å®šæ€§æµ‹è¯•
- ä¸‰ç§æ¸©åº¦è°ƒåº¦ç­–ç•¥æµ‹è¯•
- æ—  NaN æˆ–æ•°å€¼ä¸ç¨³å®šé—®é¢˜

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```yaml
optimizers:
  - vanilla
  - adasmooth  # AdaSmooth-ZO

# AdaSmooth-ZO å‚æ•°
num_queries: 64          # Kï¼ˆæ‰¹å¤§å°/åæ–¹å·®ç§©ï¼‰
mu: 0.1                  # åˆå§‹å¹³æ»‘å°ºåº¦
beta_init: 1.0           # åˆå§‹æ¸©åº¦
beta_decay: 0.05         # æ¸©åº¦è¡°å‡ç‡
beta_schedule: polynomial # è°ƒåº¦ç±»å‹
```

**æ€§èƒ½å¯¹æ¯”ï¼š**
| æ–¹æ³• | åæ–¹å·® | å¤æ‚åº¦ | è‡ªé€‚åº” | å†å²å¤ç”¨ |
|------|--------|--------|--------|----------|
| Vanilla | å›ºå®šï¼ˆçƒå½¢ï¼‰ | O(nd) | âŒ | âŒ |
| xNES | å®Œæ•´ï¼ˆdÃ—dï¼‰ | O(ndÂ²) | âœ… | âŒ |
| Sep-CMA-ES | å¯¹è§’ | O(nd) | âœ… | âŒ |
| **AdaSmooth-ZO** | **ä½ç§©ï¼ˆdÃ—Kï¼‰** | **O(Kd)** | **âœ…** | **âŒ** |
| ZoAR | å›ºå®šï¼ˆçƒå½¢ï¼‰ | O(nd) | âŒ | âœ… |

**é€‚ç”¨åœºæ™¯ï¼š**
- âœ… ä¸­é«˜ç»´ä¼˜åŒ–ï¼ˆd > 100ï¼‰
- âœ… å¤æ‚éå‡¸å‡½æ•°
- âœ… éœ€è¦è‡ªé€‚åº”åæ–¹å·®å­¦ä¹ 
- âœ… å†…å­˜å—é™åœºæ™¯ï¼ˆvs xNESï¼‰
- âœ… å‚æ•°ç›¸å…³æ€§é‡è¦çš„é—®é¢˜

---

## 2024-12-13 - xNES ä¿®å¤

### ğŸ”§ Bug ä¿®å¤

#### xNES åˆå§‹åŒ–é—®é¢˜ä¿®å¤ âœ…
ä¿®å¤ xNES ä¼˜åŒ–å™¨çš„ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼š

1. **Sigma åˆå§‹åŒ–ä¿®å¤**
   - é—®é¢˜ï¼šä½¿ç”¨ `self.mu` (0.01) å¯¼è‡´æ­¥é•¿è¿‡å°
   - ä¿®å¤ï¼šæ·»åŠ  `initial_sigma` å‚æ•°ï¼ˆé»˜è®¤ 0.1ï¼‰
   - æ”¹è¿›ï¼šæ­¥é•¿æå‡ 10 å€ï¼Œæ”¶æ•›æ›´å¿«

2. **Update Rule ä¿®å¤**
   - é—®é¢˜ï¼šé»˜è®¤ `update_rule='radazo'`ï¼Œä½† xNES éœ€è¦ SGD
   - ä¿®å¤ï¼šé»˜è®¤æ”¹ä¸º 'sgd'ï¼Œæ·»åŠ éªŒè¯é˜²æ­¢è¯¯ç”¨
   - åŸå› ï¼šxNES å†…éƒ¨å·²æœ‰è‡ªé€‚åº”æœºåˆ¶ï¼Œä¸å…¼å®¹ Adam/RadAZO

3. **Learning Rate ä¿®å¤**
   - é—®é¢˜ï¼šé»˜è®¤ `lr=0.001` è¿‡å°
   - ä¿®å¤ï¼šé»˜è®¤æ”¹ä¸º `lr=1.0`ï¼ˆç¬¦åˆ xNES æ ‡å‡†ç”¨æ³•ï¼‰

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `optimizer/zo.py` - xNES ç±»ä¿®å¤
- `utils.py` - æ³¨å†Œä»£ç æ›´æ–°
- `config/synthetic.yaml` - å‚æ•°æ–‡æ¡£æ›´æ–°
- `Docx/xNES_usage.md` - ä½¿ç”¨æ–‡æ¡£æ›´æ–°

**æ–‡æ¡£ï¼š**
- `Docx/xNES_Fix_COMPLETED.md` - ä¿®å¤å®ŒæˆæŠ¥å‘Š

---

## 2024-12-13 - Sep-CMA-ES æ›´æ–°

### âœ… æ–°å¢åŠŸèƒ½

#### 1. Sep-CMA-ES ä¼˜åŒ–å™¨ âœ¨ æœ€æ–°
- å®ç° Separable CMA-ESï¼ˆRos & Hansen 2008ï¼‰
- å¯¹è§’åæ–¹å·®çŸ©é˜µï¼ˆçº¿æ€§å¤æ‚åº¦ O(d)ï¼‰
- åŸºäºæˆç†Ÿçš„ `cmaes` åº“å®ç°
- é€‚åˆè¶…é«˜ç»´ä¼˜åŒ–ï¼ˆd > 5000ï¼‰
- Ask-Tell æ¥å£æ¨¡å¼
- è‡ªåŠ¨ç§ç¾¤å¤§å°è®¡ç®—ï¼ˆ4 + 3Â·log(d)ï¼‰

**æ–‡ä»¶ï¼š**
- `synthetic_and_adversarial/optimizer/zo.py`

**æ–‡æ¡£ï¼š**
- `Docx/SepCMAES_usage.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- `Docx/SepCMAES_summary.md` - å®ç°æ€»ç»“

---

## 2024-12-12 - ä¸»è¦æ›´æ–°

### âœ… æ–°å¢åŠŸèƒ½

#### 1. xNES ä¼˜åŒ–å™¨ âœ¨
- å®ç° Exponential Natural Evolution Strategies
- è‡ªé€‚åº”åæ–¹å·®çŸ©é˜µï¼ˆå­¦ä¹ å˜é‡ç›¸å…³æ€§ï¼‰
- è‡ªç„¶æ¢¯åº¦æ›´æ–°ï¼ˆå¿«é€Ÿæ”¶æ•›ï¼‰
- Fitness shapingï¼ˆé™ä½æ–¹å·®ï¼‰
- è‡ªåŠ¨å­¦ä¹ ç‡è®¡ç®—
- O(dÂ²) å¤æ‚åº¦ï¼Œé€‚åˆä¸­ç­‰ç»´åº¦ï¼ˆ10 < d < 5000ï¼‰

**æ–‡ä»¶ï¼š**
- `synthetic_and_adversarial/optimizer/zo.py`

**æ–‡æ¡£ï¼š**
- `Docx/xNES_usage.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- `Docx/xNES_summary.md` - å®ç°æ€»ç»“

#### 2. Rastrigin æµ‹è¯•å‡½æ•°
- æ·»åŠ é«˜åº¦å¤šå³°çš„ Rastrigin å‡½æ•°
- å…¨å±€æœ€å°å€¼ï¼šf(0) = 0
- å…¬å¼ï¼š`f(x) = 10n + Î£(x_iÂ² - 10Â·cos(2Ï€x_i))`
- é€‚åˆæµ‹è¯•å…¨å±€ä¼˜åŒ–ç®—æ³•

**æ–‡ä»¶ï¼š**
- `synthetic_and_adversarial/model/synthetic_functions.py`

#### 2. ä¸¤ç‚¹å¼ï¼ˆTwoPointï¼‰æ¢¯åº¦ä¼°è®¡å™¨
- å®ç°ä¸­å¿ƒå·®åˆ†ä¼°è®¡å™¨
- å…¬å¼ï¼š`âˆ‡f â‰ˆ [F(Î¸+Î¼u) - F(Î¸-Î¼u)]/(2Î¼) Â· u`
- æŸ¥è¯¢é¢„ç®—åŒ¹é…ï¼ˆä½¿ç”¨ num_queries//2 ä¸ªæ–¹å‘ï¼‰
- æ–¹å·®ä½äºå•ç‚¹å¼

**æ–‡ä»¶ï¼š**
- `synthetic_and_adversarial/optimizer/zo.py`

#### 3. çº¯ESï¼ˆEvolution Strategiesï¼‰ä¼˜åŒ–å™¨
- å®ç°è®ºæ–‡åŸå§‹ESå…¬å¼ï¼ˆæ— åŸºçº¿ï¼‰
- å…¬å¼ï¼š`âˆ‡f â‰ˆ (1/nÏƒ) Î£ F(Î¸+ÏƒÎµ) Â· Îµ`
- ä½œä¸ºç†è®ºåŸºçº¿å’Œç ”ç©¶å‚è€ƒ
- æ–¹å·®æœ€é«˜ä½†æ— é¢å¤–åŸºçº¿æŸ¥è¯¢

**æ–‡ä»¶ï¼š**
- `synthetic_and_adversarial/optimizer/zo.py`

---

### ğŸ”§ é…ç½®æ–‡ä»¶ä¼˜åŒ–

**ç²¾ç®€ç»“æ„ï¼š**
- âœ… ä¿ç•™åŸå§‹3ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶
- âŒ åˆ é™¤ä¸“ç”¨é…ç½®æ–‡ä»¶ï¼ˆ5ä¸ªï¼‰
- âœ… æ‰€æœ‰åŠŸèƒ½é€šè¿‡æ ¸å¿ƒé…ç½®ä½¿ç”¨

**é…ç½®æ–‡ä»¶åˆ—è¡¨ï¼š**
1. `config/synthetic.yaml` - åˆæˆå‡½æ•°æµ‹è¯•ï¼ˆä¸»è¦ï¼‰
2. `config/synthetic-baseline.yaml` - åŸºçº¿æ–¹æ³•å¯¹æ¯”
3. `config/adversarial.yaml` - é»‘ç›’å¯¹æŠ—æ”»å‡»

**æ”¹è¿›ï¼š**
- æ·»åŠ è¯¦ç»†çš„ä¼˜åŒ–å™¨æ³¨é‡Š
- æ”¯æŒæ‰€æœ‰æ–°åŠŸèƒ½ï¼ˆrastrigin, es, twopointï¼‰
- é€šè¿‡æ³¨é‡Šå¿«é€Ÿåˆ‡æ¢ä¼˜åŒ–å™¨
- å‚æ•°è¯´æ˜æ›´è¯¦ç»†

---

### ğŸ“š æ–‡æ¡£æ›´æ–°

#### æ–°å»ºæ–‡æ¡£ï¼ˆ7ä¸ªï¼‰
1. `Docx/Rastrigin_usage.md` - Rastrigin å‡½æ•°è¯¦è§£
2. `Docx/ZO_TwoPoint_usage.md` - TwoPoint ä½¿ç”¨è¯´æ˜
3. `Docx/ES_usage.md` - ES æ–¹æ³•æ—è¯¦è§£
4. `Docx/implementation_summary.md` - å®ç°æ€»ç»“
5. `Docx/ES_implementation_summary.md` - ES å®ç°è¯¦è§£
6. `Docx/quick_reference.md` - å¿«é€Ÿå‚è€ƒæ‰‹å†Œ
7. `Docx/config_guide.md` - é…ç½®æ–‡ä»¶ä½¿ç”¨æŒ‡å— âœ¨

#### æ›´æ–°æ–‡æ¡£ï¼ˆ2ä¸ªï¼‰
1. `CLAUDE.md` - é¡¹ç›®ä¸»æ–‡æ¡£å…¨é¢æ›´æ–°
2. `Docx/FINAL_SUMMARY.md` - æœ€ç»ˆæ€»ç»“

---

### ğŸ“Š å®Œæ•´ä¼˜åŒ–å™¨åˆ—è¡¨

ç°åœ¨æ”¯æŒçš„æ‰€æœ‰ä¼˜åŒ–å™¨ï¼š

**ES å®¶æ—ï¼š**
- `es` - çº¯ESï¼ˆæ— åŸºçº¿ï¼‰
- `vanilla` - ES + å•ç‚¹åŸºçº¿
- `rl` - ES + fitness shaping
- `zoo` - ZOOï¼ˆå¯é…ç½®åŸºçº¿ï¼‰
- `reinforce` - REINFORCEï¼ˆå¯é…ç½®åŸºçº¿ï¼‰

**è‡ªé€‚åº”åæ–¹å·®ï¼š**
- `xnes` - xNESï¼ˆå®Œæ•´åæ–¹å·®çŸ©é˜µï¼ŒO(dÂ²)ï¼‰âœ¨
- `sepcmaes` - Sep-CMA-ESï¼ˆå¯¹è§’åæ–¹å·®ï¼ŒO(d)ï¼Œé«˜ç»´ï¼‰âœ¨
- `adasmooth` - AdaSmooth-ZOï¼ˆä½ç§©åæ–¹å·®ï¼ŒO(Kd)ï¼Œè‡ªé€‚åº”ï¼‰âœ¨ æœ€æ–°

**æ¢¯åº¦ä¼°è®¡å™¨ï¼š**
- `twopoint` - ä¸¤ç‚¹å¼ä¸­å¿ƒå·®åˆ†

**æŸ¥è¯¢å¤ç”¨ï¼š**
- `zoar` - ZoARï¼ˆå¸¦å†å²ï¼‰
- `zoar_0` - ZoARï¼ˆæ— å†å²ï¼‰
- `relizo` - ReLIZO
- `zohs` - ZOHS
- `zohs_expavg` - ZOHS æŒ‡æ•°å¹³å‡

**å…¶ä»–ï¼š**
- `fo` - çœŸå®æ¢¯åº¦ï¼ˆä»…åˆæˆå‡½æ•°ï¼‰

---

### ğŸ¯ æµ‹è¯•å‡½æ•°åˆ—è¡¨

æ”¯æŒçš„æ‰€æœ‰æµ‹è¯•å‡½æ•°ï¼š

1. `ackley` - Ackley å‡½æ•°
2. `levy` - Levy å‡½æ•°
3. `rosenbrock` - Rosenbrock å‡½æ•°
4. `quadratic` - äºŒæ¬¡å‡½æ•°
5. `rastrigin` - Rastrigin å‡½æ•° âœ¨ æ–°å¢

---

## ä½¿ç”¨ç¤ºä¾‹

### æµ‹è¯• Rastrigin å‡½æ•°

ç¼–è¾‘ `config/synthetic.yaml`ï¼š
```yaml
func_name: rastrigin
```

è¿è¡Œï¼š
```bash
cd synthetic_and_adversarial
python run.py --config config/synthetic.yaml
```

### å¯¹æ¯” ES æ–¹æ³•

ç¼–è¾‘ `config/synthetic.yaml`ï¼š
```yaml
optimizers:
  - es       # çº¯ESï¼ˆå–æ¶ˆæ³¨é‡Šï¼‰
  - vanilla  # ES + åŸºçº¿
  - rl       # ES + æ’åºï¼ˆå–æ¶ˆæ³¨é‡Šï¼‰
  - zoar
```

### æµ‹è¯•ä¸¤ç‚¹å¼

ç¼–è¾‘ `config/synthetic.yaml`ï¼š
```yaml
optimizers:
  - vanilla   # å•ç‚¹å¼
  - twopoint  # ä¸¤ç‚¹å¼ï¼ˆå–æ¶ˆæ³¨é‡Šï¼‰
  - zoar
```

---

## æ–¹å·®å¯¹æ¯”

ä»ä½åˆ°é«˜ï¼š
```
TwoPoint < ZoAR < ZOHS < RL < Vanilla < ZOO < ES (çº¯)
```

---

## æŠ€æœ¯ç»†èŠ‚

### æŸ¥è¯¢æˆæœ¬

| ä¼˜åŒ–å™¨ | æ¯æ¬¡è¿­ä»£æŸ¥è¯¢æ•° |
|--------|---------------|
| ES (çº¯) | n |
| Vanilla | 1 + n |
| TwoPoint | 1 + n (ä½¿ç”¨ n/2 ä¸ªæ–¹å‘) |
| RL | 1 + n |
| ZoAR | nï¼ˆå¤ç”¨å†å²ï¼‰ |

### æ•°å­¦å…¬å¼

**ES (çº¯)ï¼š**
```
âˆ‡f â‰ˆ (1/nÏƒ) Î£ F(Î¸+ÏƒÎµ) Â· Îµ
```

**Vanillaï¼š**
```
âˆ‡f â‰ˆ (1/nÎ¼) Î£ [F(Î¸+Î¼u) - F(Î¸)] Â· u
```

**TwoPointï¼š**
```
âˆ‡f â‰ˆ (1/m) Î£ [F(Î¸+Î¼u) - F(Î¸-Î¼u)]/(2Î¼) Â· u
å…¶ä¸­ m = num_queries // 2
```

**Rastriginï¼š**
```
f(x) = 10n + Î£(x_iÂ² - 10Â·cos(2Ï€x_i))
```

---

## å‘åå…¼å®¹æ€§

âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜
âœ… åŸæœ‰é…ç½®æ–‡ä»¶ç»§ç»­æœ‰æ•ˆ
âœ… æ–°åŠŸèƒ½é€šè¿‡æ³¨é‡Šå¯é€‰å¯ç”¨
âœ… é»˜è®¤è¡Œä¸ºä¸å˜

---

## ä¸‹ä¸€æ­¥å»ºè®®

1. **è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š**
   ```bash
   python run.py --config config/synthetic.yaml
   ```

2. **å¯¹æ¯” ES æ–¹æ³•ï¼š**
   - å¯ç”¨ es, vanilla, rl, zoar
   - è§‚å¯Ÿæ–¹å·®å·®å¼‚

3. **æµ‹è¯• Rastriginï¼š**
   - åœ¨é«˜åº¦å¤šå³°å‡½æ•°ä¸ŠéªŒè¯ç®—æ³•

4. **åˆ†æç»“æœï¼š**
   ```python
   import torch
   history = torch.load('results/synthetic/...')
   ```

---

## è‡´è°¢

æ„Ÿè°¢åŸä½œè€…æä¾›çš„ä¼˜ç§€ä»£ç æ¡†æ¶ï¼

æœ¬æ¬¡æ›´æ–°å¢å¼ºäº†å®éªŒçµæ´»æ€§å’Œæ–‡æ¡£å®Œæ•´æ€§ã€‚
